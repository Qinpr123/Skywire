<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’¢ä¸è¡Œè€… - å¹³è¡¡æŒ‘æˆ˜</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- åŠ è½½ç•Œé¢ -->
    <div id="loadingScreen">
        <div class="wrapper">
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="shadow"></div>
            <div class="shadow"></div>
            <div class="shadow"></div>
        </div>
    </div>
    
    <div id="bgBlur"></div>
    <div id="gameContainer" data-design-width="832" data-design-height="1480">
        <canvas id="gameCanvas" width="832" height="1480"></canvas>
        
        <div id="progressContainer">
            <div id="progressBar">
                <div id="progressFill"></div>
                <div id="bestDistanceLine"></div>
                <div id="maxDistance">6666m</div>
            </div>
            <div id="bestDistanceLabel">0m</div>
            <div id="currentDistance">
                <span id="currentDistanceNumber">0</span><span id="currentDistanceUnit">m</span>
            </div>
        </div>
        
        <!-- å…¨å±€éŸ³é¢‘æ§åˆ¶ -->
        <div id="audioControls">
            <button id="muteBtn" title="é™éŸ³/å–æ¶ˆé™éŸ³">ğŸ”Š</button>
            <input type="range" id="volumeSlider" min="0" max="100" value="30" title="éŸ³é‡æ§åˆ¶">
        </div>
        
        <!-- å…¨å±€æ“ä½œè¯´æ˜é—®å· -->
        <div id="helpTrigger">
            <div class="help-icon">?</div>
            <!-- æ“ä½œè¯´æ˜å†…å®¹ -->
            <div id="instructions">
                <div class="instruction-item">
                    <span class="key">â‡ â‡’</span>
                    <span class="desc">æ§åˆ¶å¹³è¡¡</span>
                </div>
                <div class="instruction-item">
                    <span class="key">Z</span>
                    <span class="desc">ä¼¸é•¿å¹³è¡¡æ†</span>
                </div>
                <div class="instruction-item">
                    <span class="key">X</span>
                    <span class="desc">ç¼©çŸ­å¹³è¡¡æ†</span>
                </div>
                <div class="instruction-item">
                    <span class="key">ç©ºæ ¼</span>
                    <span class="desc">å¼€å§‹/æš‚åœ</span>
                </div>
                <div class="instruction-tip">ä¿æŒæ‘†å¹… < 60Â° é¿å…å è½</div>
            </div>
        </div>
        
        <div id="startScreen">
            <!-- ç”¨æˆ·é€‰æ‹©åŒºåŸŸ -->
            <div id="userSelection">
                <h3>é€‰æ‹©ç©å®¶</h3>
                <div id="userList"></div>
                <div id="userInputArea">
                    <input type="text" id="newUserName" placeholder="è¾“å…¥æ–°ç©å®¶åç§°" maxlength="10">
                    <button id="createUserBtn">åˆ›å»ºæ–°ç©å®¶</button>
                </div>
                <div id="leaderboard">
                    <h4>æ’è¡Œæ¦œ</h4>
                    <div id="leaderboardList"></div>
                </div>
            </div>
            <!-- å¼€å§‹æŒ‰é’® -->
            <button id="startButton" style="display: none;">
                <span>æŒ‰ç©ºæ ¼é”®å¼€å§‹æ¸¸æˆ</span>
            </button>
        </div>
        <div id="gameOver">
            <h2 id="gameOverTitle">æ¸¸æˆç»“æŸï¼</h2>
            <p id="gameOverMessage">ä½ èµ°äº† <span id="finalDistance">0</span> ç±³</p>
            <div class="restart-prompt">
                <p>æŒ‰ç©ºæ ¼é”®é‡æ–°æŒ‘æˆ˜</p>
                <button id="switchUserBtn" style="margin-top: 15px; padding: 10px 20px; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); border-radius: 8px; color: white; cursor: pointer; font-size: 0.9em;">åˆ‡æ¢ç©å®¶</button>
            </div>
        </div>
        
        <div id="pauseScreen">
            <h2>æ¸¸æˆæš‚åœ</h2>
            <div class="powerup-guide">
                <h3>é“å…·è¯´æ˜</h3>
                <div class="powerup-list">
                    <div class="powerup-item">
                        <div class="powerup-icon slow-icon">
                            <img src="image/item_slow.png" alt="å‡é€Ÿé“å…·">
                        </div>
                        <div class="powerup-info">
                            <span class="powerup-name">å‡é€Ÿé“å…·</span>
                            <span class="powerup-desc">é™ä½ç§»åŠ¨é€Ÿåº¦</span>
                        </div>
                    </div>
                    <div class="powerup-item">
                        <div class="powerup-icon unbalance-icon">
                            <img src="image/item_disrupt the balance.png" alt="å¤±è¡¡é“å…·">
                        </div>
                        <div class="powerup-info">
                            <span class="powerup-name">å¤±è¡¡é“å…·</span>
                            <span class="powerup-desc">å¢åŠ æ‘†å¹…éš¾åº¦</span>
                        </div>
                    </div>
                    <div class="powerup-item">
                        <div class="powerup-icon explosion-icon">
                            <img src="image/item_bomb.png" alt="çˆ†ç‚¸é“å…·">
                        </div>
                        <div class="powerup-info">
                            <span class="powerup-name">çˆ†ç‚¸é“å…·</span>
                            <span class="powerup-desc">ç›´æ¥æ¸¸æˆç»“æŸ</span>
                        </div>
                    </div>
                    <div class="powerup-item">
                        <div class="powerup-icon speed-icon">
                            <img src="image/item_fast.png" alt="åŠ é€Ÿé“å…·">
                        </div>
                        <div class="powerup-info">
                            <span class="powerup-name">åŠ é€Ÿé“å…·</span>
                            <span class="powerup-desc">æå‡ç§»åŠ¨é€Ÿåº¦2å€</span>
                        </div>
                    </div>
                    <div class="powerup-item">
                        <div class="powerup-icon balance-icon">
                            <img src="image/item_keep balance.png" alt="å¹³è¡¡é“å…·">
                        </div>
                        <div class="powerup-info">
                            <span class="powerup-name">å¹³è¡¡é“å…·</span>
                            <span class="powerup-desc">ä¿æŒå¹³è¡¡3ç§’</span>
                        </div>
                    </div>
                </div>
            </div>
            <p class="continue-text">æŒ‰ç©ºæ ¼é”®ç»§ç»­æ¸¸æˆ</p>
        </div>
    </div>

    <script src="main.js"></script>
    <script>
        class TightropeGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.width = this.canvas.width;
                this.height = this.canvas.height;
                
                // æ¸¸æˆçŠ¶æ€
                this.gameRunning = false;
                this.distance = 0;
                this.speed = 0.083; // 1ç§’5ç±³ï¼Œ60fpsä¸‹æ¯å¸§çº¦0.083ç±³
                this.score = 0;
                this.highScore = localStorage.getItem('tightropeHighScore') || 0;
                this.gameStarted = false;
                
                // ä¸»è§’å±æ€§
                this.player = {
                    x: this.width / 2,
                    y: this.height / 2,
                    sway: 0, // æ‘†å¹…è§’åº¦
                    swaySpeed: 0, // æ‘†å¹…é€Ÿåº¦
                    size: 40
                };
                
                // é’¢ä¸
                this.tightrope = {
                    x: this.width / 2,
                    thickness: 6
                };
                
                // é£åŠ›ç³»ç»Ÿ
                this.wind = {
                    force: 0,
                    direction: 1, // 1 æˆ– -1
                    changeTimer: 0,
                    changeInterval: 60 // å¸§æ•°
                };
                
                // èƒŒæ™¯
                this.background = {
                    offset: 0,
                    speed: 1
                };
                
                // ç²’å­ç³»ç»Ÿ
                this.particles = [];
                
                // ç”°å›­é£æ™¯ç³»ç»Ÿå·²ç§»é™¤
                this.landscape = [];
                this.landscapeSpeed = this.speed * 2;
                this.landscapeSpawnTimer = 0;
                this.landscapeSpawnInterval = 200;
                
                
                // é“å…·ç³»ç»Ÿ
                this.powerUps = [];
                this.powerUpSpawnTimer = 0;
                this.powerUpSpawnInterval = 20; // å¸§æ•°ï¼Œ0.3ç§’ç”Ÿæˆä¸€ä¸ª
                this.activePowerUps = []; // å½“å‰æ¿€æ´»çš„é“å…·
                
                // å¹³è¡¡æ†ç³»ç»Ÿ
                this.balanceRod = {
                    length: 60, // é»˜è®¤é•¿åº¦
                    minLength: 30,
                    maxLength: 120,
                    extendSpeed: 2
                };
                
                // æ§åˆ¶
                this.keys = {};
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.gameLoop();
            }
            
            setupEventListeners() {
                // é”®ç›˜äº‹ä»¶
                document.addEventListener('keydown', (e) => {
                    this.keys[e.code] = true;
                    if (e.code === 'Space' && !this.gameRunning) {
                        this.startGame();
                    }
                });
                
                document.addEventListener('keyup', (e) => {
                    this.keys[e.code] = false;
                });
                
                // é‡æ–°å¼€å§‹æŒ‰é’®
                document.getElementById('restartBtn').addEventListener('click', () => {
                    this.restartGame();
                });
            }
            
            startGame() {
                this.gameRunning = true;
                this.gameStarted = true;
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('gameOver').style.display = 'none';
                this.resetGame();
                // ç”°å›­é£æ™¯ç³»ç»Ÿå·²ç§»é™¤
            }
            
            restartGame() {
                this.gameRunning = true;
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('gameOver').style.display = 'none';
                this.resetGame();
                // ç”°å›­é£æ™¯ç³»ç»Ÿå·²ç§»é™¤
            }
            
            resetGame() {
                this.distance = 0;
                this.score = 0;
                this.player.x = this.width / 2;
                this.player.y = this.height / 2;
                this.player.sway = 0;
                this.player.swaySpeed = 0;
                this.wind.force = 0;
                this.wind.direction = 1;
                this.wind.changeTimer = 0;
                this.background.offset = 0;
                this.landscape = [];
                this.landscapeSpawnTimer = 0;
                this.powerUps = [];
                this.powerUpSpawnTimer = 0;
                this.activePowerUps = [];
                this.balanceRod.length = 60;
            }
            
            update() {
                if (!this.gameRunning) return;
                
                // æ›´æ–°è·ç¦»å’Œåˆ†æ•°
                this.distance += this.speed;
                this.score = Math.floor(this.distance);
                
                // æ›´æ–°é£åŠ›
                this.updateWind();
                
                // æ›´æ–°ç©å®¶å¹³è¡¡
                this.updatePlayerBalance();
                
                // æ›´æ–°èƒŒæ™¯
                this.updateBackground();
                
                // æ›´æ–°ç²’å­
                this.updateParticles();
                
                // ç”°å›­é£æ™¯ç³»ç»Ÿå·²ç§»é™¤
                
                
                // æ›´æ–°é“å…·
                this.updatePowerUps();
                
                // æ›´æ–°å¹³è¡¡æ†
                this.updateBalanceRod();
                
                // æ£€æŸ¥å¤±è´¥æ¡ä»¶
                this.checkGameOver();
                
                // æ›´æ–°UI
                this.updateUI();
            }
            
            updateWind() {
                this.wind.changeTimer++;
                if (this.wind.changeTimer >= this.wind.changeInterval) {
                    this.wind.direction *= -1;
                    this.wind.force = (Math.random() - 0.5) * 0.3;
                    this.wind.changeTimer = 0;
                    this.wind.changeInterval = 30 + Math.random() * 60;
                }
                
                // é£åŠ›é€æ¸å˜åŒ–
                this.wind.force += (Math.random() - 0.5) * 0.02;
                this.wind.force = Math.max(-0.5, Math.min(0.5, this.wind.force));
            }
            
            updatePlayerBalance() {
                // æ£€æŸ¥æ˜¯å¦æœ‰å¹³è¡¡å¢å¼ºé“å…·ä¸”å…ç–«é”®ç›˜è¾“å…¥
                let isImmuneToInput = false;
                let isBalanceRestore = false;
                for (let powerUp of this.activePowerUps) {
                    if (powerUp.type === 'balance' && powerUp.immuneToInput) {
                        isImmuneToInput = true;
                        if (powerUp.balanceRestore) {
                            isBalanceRestore = true;
                        }
                        break;
                    }
                }
                
                // å¦‚æœå¤„äºå¹³è¡¡æ¢å¤çŠ¶æ€ï¼Œä¿æŒå¹³è¡¡
                if (isBalanceRestore) {
                    this.player.sway = 0; // å¼ºåˆ¶ä¿æŒå¹³è¡¡
                    this.player.swaySpeed = 0; // åœæ­¢æ‘†è¡
                    return; // ç›´æ¥è¿”å›ï¼Œä¸å¤„ç†å…¶ä»–åŠ›
                }
                
                // é£åŠ›å½±å“ï¼ˆç¼©å°ä¸¤å€ï¼‰
                let windEffect = this.wind.force * this.wind.direction * 0.5; // ä»1ç¼©å°åˆ°0.5
                
                // ç©å®¶æ§åˆ¶ï¼ˆç¼©å°ä¸¤å€ï¼Œä¸”å¯èƒ½è¢«å…ç–«ï¼‰
                let controlForce = 0;
                if (!isImmuneToInput) { // åªæœ‰åœ¨ä¸å…ç–«é”®ç›˜è¾“å…¥æ—¶æ‰å“åº”
                    if (this.keys['ArrowLeft']) {
                        controlForce = -0.075; // ä»-0.15ç¼©å°åˆ°-0.075
                    }
                    if (this.keys['ArrowRight']) {
                        controlForce = 0.075; // ä»0.15ç¼©å°åˆ°0.075
                    }
                }
                
                // è®¡ç®—æ€»åŠ›
                let totalForce = windEffect + controlForce;
                
                // æ›´æ–°æ‘†å¹…é€Ÿåº¦
                this.player.swaySpeed += totalForce;
                
                // åº”ç”¨å¹³è¡¡é“å…·æ•ˆæœ
                let damping = 0.95; // é»˜è®¤é˜»å°¼
                for (let powerUp of this.activePowerUps) {
                    if (powerUp.type === 'balance') {
                        damping = 0.98; // å¢å¼ºé˜»å°¼ï¼Œå‡å°‘æ‘†è¡
                    } else if (powerUp.type === 'unbalance') {
                        damping = 0.90; // å‡å°‘é˜»å°¼ï¼Œå¢åŠ æ‘†è¡
                    }
                }
                this.player.swaySpeed *= damping;
                
                // æ›´æ–°æ‘†å¹…
                this.player.sway += this.player.swaySpeed;
                
                // é™åˆ¶æ‘†å¹…èŒƒå›´
                this.player.sway = Math.max(-90, Math.min(90, this.player.sway));
                
                // æ›´æ–°ç©å®¶ä½ç½®ï¼ˆä»¥è„šä¸ºåœ†å¿ƒæ—‹è½¬ï¼‰
                this.player.x = this.tightrope.x;
                this.player.y = this.height / 2;
            }
            
            updateBackground() {
                this.background.offset += this.background.speed;
                if (this.background.offset >= this.height) {
                    this.background.offset = 0;
                }
            }
            
            updateParticles() {
                // æ·»åŠ æ–°ç²’å­
                if (Math.random() < 0.3) {
                    this.particles.push({
                        x: Math.random() * this.width,
                        y: this.height + 10,
                        vx: (Math.random() - 0.5) * 2,
                        vy: -Math.random() * 3 - 1,
                        life: 1.0,
                        decay: 0.01,
                        size: Math.random() * 3 + 1
                    });
                }
                
                // æ›´æ–°ç°æœ‰ç²’å­
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const particle = this.particles[i];
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life -= particle.decay;
                    
                    if (particle.life <= 0 || particle.y < -10) {
                        this.particles.splice(i, 1);
                    }
                }
            }
            
            updateLandscape() {
                // ç”°å›­é£æ™¯ç³»ç»Ÿå·²ç§»é™¤
                return;
            }
            
            
            updatePowerUps() {
                // ç”Ÿæˆæ–°é“å…·
                this.powerUpSpawnTimer++;
                if (this.powerUpSpawnTimer >= this.powerUpSpawnInterval) {
                    this.spawnPowerUp();
                    this.powerUpSpawnTimer = 0;
                    this.powerUpSpawnInterval = 60 + Math.random() * 60; // 1-2ç§’éšæœºé—´éš”
                }
                
                // æ›´æ–°ç°æœ‰é“å…·ä½ç½®
                for (let i = this.powerUps.length - 1; i >= 0; i--) {
                    const powerUp = this.powerUps[i];
                    powerUp.y += 7; // ä¸‹è½é€Ÿåº¦å‡ç¼“åˆ°1/3
                    
                    // æ£€æŸ¥æ˜¯å¦è¢«ç©å®¶æ”¶é›†
                    if (this.checkPowerUpCollision(powerUp)) {
                        this.collectPowerUp(powerUp);
                        this.powerUps.splice(i, 1);
                    }
                    // ç§»é™¤è¶…å‡ºå±å¹•çš„é“å…·
                    else if (powerUp.y > this.height + 100) {
                        this.powerUps.splice(i, 1);
                    }
                }
                
                // æ›´æ–°æ¿€æ´»çš„é“å…·
                for (let i = this.activePowerUps.length - 1; i >= 0; i--) {
                    const powerUp = this.activePowerUps[i];
                    powerUp.duration--;
                    
                    if (powerUp.duration <= 0) {
                        this.deactivatePowerUp(powerUp);
                        this.activePowerUps.splice(i, 1);
                    }
                }
            }
            
            updateBalanceRod() {
                // å¹³è¡¡æ†ä¼¸é•¿ç¼©çŸ­æ§åˆ¶
                if (this.keys['KeyZ'] || this.keys['KeyX']) {
                    if (this.keys['KeyZ']) {
                        // Zé”®ä¼¸é•¿
                        this.balanceRod.length = Math.min(this.balanceRod.maxLength, 
                            this.balanceRod.length + this.balanceRod.extendSpeed);
                    }
                    if (this.keys['KeyX']) {
                        // Xé”®ç¼©çŸ­
                        this.balanceRod.length = Math.max(this.balanceRod.minLength, 
                            this.balanceRod.length - this.balanceRod.extendSpeed);
                    }
                }
            }
            
            spawnLandscapeElement() {
                // ä¸å†ç”Ÿæˆä»£ç ç»˜åˆ¶çš„å…ƒç´ 
                return;
            }
            
            
            spawnPowerUp() {
                // å‡å°‘çˆ†ç‚¸å‡ºç°é¢‘ç‡ï¼Œå…¶ä»–é“å…·å‡ºç°æ¦‚ç‡æ›´é«˜
                const types = ['speed', 'balance', 'slow', 'unbalance', 'speed', 'balance', 'slow', 'unbalance', 'explosion']; // çˆ†ç‚¸åªæœ‰1/9çš„æ¦‚ç‡
                const type = types[Math.floor(Math.random() * types.length)];
                
                // é“å…·æ‰è½èŒƒå›´ï¼šä»å¹³è¡¡æ†åˆå§‹é•¿åº¦åˆ°å¹³è¡¡æ†æœ€é•¿ä¼¸é•¿é•¿åº¦
                const tightropeX = this.tightrope.x;
                const minDistance = this.balanceRod.minLength+10; // å¹³è¡¡æ†åˆå§‹é•¿åº¦
                const maxDistance = this.balanceRod.maxLength; // å¹³è¡¡æ†æœ€é•¿ä¼¸é•¿é•¿åº¦
                
                // éšæœºé€‰æ‹©å·¦ä¾§æˆ–å³ä¾§
                const side = Math.random() < 0.5 ? -1 : 1;
                const distance = minDistance + Math.random() * (maxDistance - minDistance);
                const x = tightropeX + (side * distance);
                
                this.powerUps.push({
                    x: x,
                    y: -50, // ä»å±å¹•ä¸Šæ–¹å¼€å§‹
                    type: type,
                    size: 20,
                    collected: false
                });
            }
            
            checkPowerUpCollision(powerUp) {
                // æ£€æŸ¥é“å…·æ˜¯å¦ä¸å¹³è¡¡æ†ç¢°æ’
                const playerX = this.tightrope.x;
                const playerY = this.height / 2;
                const rodLength = this.balanceRod.length;
                
                // å¹³è¡¡æ†çš„å·¦å³ç«¯ç‚¹
                const rodLeft = playerX - rodLength;
                const rodRight = playerX + rodLength;
                
                // æ£€æŸ¥é“å…·æ˜¯å¦åœ¨å¹³è¡¡æ†èŒƒå›´å†…
                return powerUp.x >= rodLeft && powerUp.x <= rodRight && 
                       powerUp.y >= playerY - 20 && powerUp.y <= playerY + 20;
            }
            
            collectPowerUp(powerUp) {
                // æ’­æ”¾éŸ³æ•ˆ
                this.playSound(powerUp.type);
                
                // æ˜¾ç¤ºé“å…·æ•ˆæœ
                this.showPowerUpEffect(powerUp);
                
                // æ£€æŸ¥å¹³è¡¡é“å…·æ˜¯å¦ä¼šè¢«å…¶ä»–é“å…·å½±å“
                if (this.hasActivePowerUp('balance') && (powerUp.type === 'unbalance' || powerUp.type === 'slow')) {
                    // å¹³è¡¡é“å…·é‡åˆ°å¤±è¡¡æˆ–å‡é€Ÿé“å…·æ—¶ç«‹å³å¤±æ•ˆ
                    this.clearBalanceEffect();
                }
                
                // æ¿€æ´»æ–°é“å…·æ•ˆæœ
                const activePowerUp = {
                    type: powerUp.type,
                    duration: powerUp.type === 'balance' ? 180 : 300, // å¹³è¡¡3ç§’ï¼Œå…¶ä»–5ç§’ï¼Œ60fps
                    originalValue: null
                };
                
                if (powerUp.type === 'explosion') {
                    // çˆ†ç‚¸é“å…· - ç›´æ¥æ­»äº¡
                    this.gameOver();
                    return;
                } else if (powerUp.type === 'speed') {
                    // åŠ é€Ÿé“å…· - å¯ä»¥å åŠ 
                    if (this.hasActivePowerUp('speed')) {
                        // å¦‚æœå·²æœ‰åŠ é€Ÿæ•ˆæœï¼Œå åŠ æ•ˆæœ
                        this.speed *= 2; // å†æ¬¡æå‡2å€
                    } else {
                        // é¦–æ¬¡è·å¾—åŠ é€Ÿæ•ˆæœ
                        activePowerUp.originalValue = this.speed;
                        this.speed *= 2; // é€Ÿåº¦æå‡2å€
                    }
                } else if (powerUp.type === 'balance') {
                    // å¹³è¡¡å¢å¼ºé“å…· - å¯ä»¥å åŠ 
                    this.player.sway = 0; // ç«‹å³å›åˆ°ä¸­å¿ƒä½ç½®
                    this.player.swaySpeed = 0; // åœæ­¢æ‘†è¡
                    if (!this.hasActivePowerUp('balance')) {
                        // é¦–æ¬¡è·å¾—å¹³è¡¡æ•ˆæœ
                        activePowerUp.originalValue = 0.95; // é˜»å°¼ç³»æ•°
                        activePowerUp.immuneToInput = true; // æ ‡è®°ä¸ºå…ç–«é”®ç›˜è¾“å…¥
                        activePowerUp.balanceRestore = true; // æ ‡è®°ä¸ºå¹³è¡¡æ¢å¤çŠ¶æ€
                    } else {
                        // å åŠ å¹³è¡¡æ•ˆæœï¼Œå»¶é•¿æŒç»­æ—¶é—´
                        const existingBalance = this.activePowerUps.find(p => p.type === 'balance');
                        existingBalance.duration = 180; // é‡ç½®æŒç»­æ—¶é—´ä¸º3ç§’
                    }
                } else if (powerUp.type === 'slow') {
                    // å‡é€Ÿé“å…· - å¯ä»¥å åŠ 
                    if (this.hasActivePowerUp('slow')) {
                        // å¦‚æœå·²æœ‰å‡é€Ÿæ•ˆæœï¼Œå åŠ æ•ˆæœ
                        this.speed *= 0.5; // å†æ¬¡é™¤ä»¥2
                    } else {
                        // é¦–æ¬¡è·å¾—å‡é€Ÿæ•ˆæœ
                        activePowerUp.originalValue = this.speed;
                        this.speed *= 0.5; // é€Ÿåº¦é™¤ä»¥2
                    }
                } else if (powerUp.type === 'unbalance') {
                    // ç ´åå¹³è¡¡é“å…· - å¤±è¡¡æ•ˆæœï¼Œå‘é“å…·ä¸‹è½æ–¹å‘æ—‹è½¬15åº¦
                    const unbalanceOffset = powerUp.x > this.tightrope.x ? 15 : -15; // æ ¹æ®é“å…·ä½ç½®å†³å®šæ—‹è½¬æ–¹å‘
                    this.player.sway += unbalanceOffset; // å‘é“å…·ä¸‹è½æ–¹å‘æ—‹è½¬15åº¦
                    // å¤±è¡¡é“å…·ä¹Ÿå¯ä»¥å åŠ ï¼Œå»¶é•¿æŒç»­æ—¶é—´
                    if (this.hasActivePowerUp('unbalance')) {
                        const existingUnbalance = this.activePowerUps.find(p => p.type === 'unbalance');
                        existingUnbalance.duration = 300; // é‡ç½®æŒç»­æ—¶é—´ä¸º5ç§’
                        return; // ä¸åˆ›å»ºæ–°çš„activePowerUp
                    }
                }
                
                // åªæœ‰é¦–æ¬¡è·å¾—çš„é“å…·æ‰æ·»åŠ åˆ°activePowerUps
                if (!this.hasActivePowerUp(powerUp.type)) {
                    this.activePowerUps.push(activePowerUp);
                }
            }
            
            hasActivePowerUp(type) {
                // æ£€æŸ¥æ˜¯å¦æœ‰æŒ‡å®šç±»å‹çš„æ¿€æ´»é“å…·
                return this.activePowerUps.some(powerUp => powerUp.type === type);
            }
            
            clearBalanceEffect() {
                // æ¸…é™¤å¹³è¡¡é“å…·æ•ˆæœ
                const balanceIndex = this.activePowerUps.findIndex(powerUp => powerUp.type === 'balance');
                if (balanceIndex !== -1) {
                    this.activePowerUps.splice(balanceIndex, 1);
                }
                // æ¢å¤åŸå§‹é˜»å°¼ç³»æ•°
                this.player.damping = 0.95;
            }
            
            clearAllPowerUpEffects() {
                // æ¸…é™¤æ‰€æœ‰ç°æœ‰é“å…·æ•ˆæœï¼Œæ¢å¤åŸå§‹çŠ¶æ€
                for (let powerUp of this.activePowerUps) {
                    if (powerUp.type === 'speed' || powerUp.type === 'slow') {
                        this.speed = powerUp.originalValue;
                    }
                    // å…¶ä»–æ•ˆæœä¼šè‡ªåŠ¨æ¢å¤
                }
                this.activePowerUps = []; // æ¸…ç©ºæ‰€æœ‰æ¿€æ´»çš„é“å…·
            }
            
            deactivatePowerUp(powerUp) {
                // å–æ¶ˆé“å…·æ•ˆæœ
                if (powerUp.type === 'speed') {
                    // å¯¹äºå åŠ çš„åŠ é€Ÿæ•ˆæœï¼Œéœ€è¦é€æ­¥æ¢å¤
                    this.speed = powerUp.originalValue;
                } else if (powerUp.type === 'balance') {
                    // æ¢å¤åŸå§‹é˜»å°¼
                } else if (powerUp.type === 'slow') {
                    // å¯¹äºå åŠ çš„å‡é€Ÿæ•ˆæœï¼Œéœ€è¦é€æ­¥æ¢å¤
                    this.speed = powerUp.originalValue;
                } else if (powerUp.type === 'unbalance') {
                    // æ¢å¤åŸå§‹é˜»å°¼
                }
            }
            
            playSound(type) {
                // ç®€å•çš„éŸ³æ•ˆæ¨¡æ‹Ÿï¼ˆä½¿ç”¨Web Audio APIï¼‰
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    // æ ¹æ®é“å…·ç±»å‹è®¾ç½®ä¸åŒéŸ³æ•ˆ
                    if (type === 'speed' || type === 'balance') {
                        // æ­£é¢é“å…· - é«˜éŸ³
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    } else if (type === 'explosion') {
                        // æ­»äº¡é“å…· - ä½éŸ³
                        oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    } else {
                        // è´Ÿé¢é“å…· - ä¸­éŸ³
                        oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    }
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (e) {
                    // éŸ³æ•ˆæ’­æ”¾å¤±è´¥æ—¶é™é»˜å¤„ç†
                }
            }
            
            showPowerUpEffect(powerUp) {
                // æ˜¾ç¤ºé“å…·æ•ˆæœæ–‡å­— - åŠ å¤§ä¸¤å€å¹¶æ˜¾ç¤ºåœ¨å±å¹•æ­£ä¸­é—´äººç‰©ä¸‹æ–¹
                const effectText = document.createElement('div');
                effectText.style.position = 'absolute';
                effectText.style.left = '50%';
                effectText.style.top = '60%'; // äººç‰©ä¸‹æ–¹
                effectText.style.transform = 'translateX(-50%)'; // æ°´å¹³å±…ä¸­
                effectText.style.color = this.getPowerUpColor(powerUp.type);
                effectText.style.fontSize = '40px'; // åŠ å¤§ä¸¤å€ï¼ˆä»20pxåˆ°40pxï¼‰
                effectText.style.fontWeight = 'bold';
                effectText.style.pointerEvents = 'none';
                effectText.style.zIndex = '1000';
                effectText.style.textAlign = 'center';
                effectText.style.textShadow = '2px 2px 4px rgba(0,0,0,0.8)'; // æ·»åŠ é˜´å½±å¢å¼ºå¯è¯»æ€§
                effectText.textContent = this.getPowerUpText(powerUp.type);
                
                document.body.appendChild(effectText);
                
                // åŠ¨ç”»æ•ˆæœ
                let opacity = 1;
                let y = 60; // ä»60%å¼€å§‹
                const animate = () => {
                    opacity -= 0.015; // ç¨å¾®æ…¢ä¸€ç‚¹çš„æ·¡å‡º
                    y -= 0.5; // å‘ä¸Šç§»åŠ¨
                    effectText.style.opacity = opacity;
                    effectText.style.top = y + '%';
                    
                    if (opacity > 0) {
                        requestAnimationFrame(animate);
                    } else {
                        document.body.removeChild(effectText);
                    }
                };
                animate();
            }
            
            getPowerUpColor(type) {
                const colors = {
                    'speed': '#FF0000',      // çº¢è‰² - å¥½é“å…·
                    'balance': '#FF0000',    // çº¢è‰² - å¥½é“å…·
                    'explosion': '#000000',  // é»‘è‰² - åé“å…·
                    'rock': '#000000',       // é»‘è‰² - åé“å…·
                    'slow': '#000000',       // é»‘è‰² - åé“å…·
                    'unbalance': '#000000'   // é»‘è‰² - åé“å…·
                };
                return colors[type] || '#FFFFFF';
            }
            
            getPowerUpText(type) {
                const texts = {
                    'explosion': 'çˆ†ç‚¸!',
                    'speed': 'é€Ÿåº¦æå‡!',
                    'balance': 'å¹³è¡¡å¢å¼º!',
                    'slow': 'å‡é€Ÿ!',
                    'unbalance': 'å¹³è¡¡ç ´å!'
                };
                return texts[type] || 'æœªçŸ¥é“å…·';
            }
            
            initializeLandscape() {
                // ç”°å›­é£æ™¯ç³»ç»Ÿå·²ç§»é™¤
                return;
            }
            
            
            checkGameOver() {
                if (Math.abs(this.player.sway) >= 60) {
                    this.gameOver();
                }
            }
            
            gameOver() {
                this.gameRunning = false;
                const finalScore = Math.floor(this.distance);
                document.getElementById('finalDistance').textContent = finalScore;
                
                // æ›´æ–°æœ€é«˜åˆ†
                if (finalScore > this.highScore) {
                    this.highScore = finalScore;
                    localStorage.setItem('tightropeHighScore', this.highScore);
                }
                
                document.getElementById('gameOver').style.display = 'block';
            }
            
            updateUI() {
                document.getElementById('distance').textContent = Math.floor(this.distance);
                document.getElementById('sway').textContent = Math.floor(Math.abs(this.player.sway));
                document.getElementById('wind').textContent = (this.wind.force * this.wind.direction).toFixed(2);
                document.getElementById('highScore').textContent = this.highScore;
            }
            
            render() {
                // æ¸…ç©ºç”»å¸ƒ
                this.ctx.clearRect(0, 0, this.width, this.height);
                
                // ç»˜åˆ¶èƒŒæ™¯
                this.drawBackground();
                
                // ä»£ç ç»˜åˆ¶çš„é’¢ä¸å·²ç§»é™¤
                // ä»£ç ç»˜åˆ¶çš„ç©å®¶è§’è‰²å·²ç§»é™¤
                // ä»£ç ç»˜åˆ¶çš„é£åŠ›æŒ‡ç¤ºå™¨å·²ç§»é™¤
                
                // ç»˜åˆ¶æ‘†å¹…æŒ‡ç¤ºå™¨
                this.drawSwayIndicator();
                
                // ç»˜åˆ¶ç²’å­
                this.drawParticles();
                
                // ç»˜åˆ¶é“å…·
                this.drawPowerUps();
            }
            
            drawBackground() {
                // æ¸å˜èƒŒæ™¯å·²ç§»é™¤ï¼Œä¸å†ç»˜åˆ¶ä»»ä½•ä»£ç ç”Ÿæˆçš„èƒŒæ™¯
                // ç”°å›­é£æ™¯ç³»ç»Ÿå·²ç§»é™¤
                // è£…é¥°æ°”çƒå·²åˆ é™¤
            }
            
            
            
            drawScrollingLandscape() {
                // ç”°å›­é£æ™¯ç³»ç»Ÿå·²ç§»é™¤
                return;
            }
            
            drawLandscapeElement(element) {
                // ä¸å†ç»˜åˆ¶ä»£ç ç”Ÿæˆçš„å…ƒç´ 
                return;
            }
            
            
            drawBalloons() {
                // è£…é¥°æ°”çƒå·²åˆ é™¤
                return;
            }
            
            drawTightrope() {
                // ä»£ç ç»˜åˆ¶çš„é’¢ä¸å·²ç§»é™¤
                return;
            }
            
            drawPlayer() {
                // ä»£ç ç»˜åˆ¶çš„ç©å®¶è§’è‰²å·²ç§»é™¤
                return;
            }
            
            drawWindIndicator() {
                // ä»£ç ç»˜åˆ¶çš„é£åŠ›æŒ‡ç¤ºå™¨å·²ç§»é™¤
                return;
            }
            
            drawSwayIndicator() {
                const x = 80; // ä»ªè¡¨ç›˜ä¸­å¿ƒXåæ ‡
                const y = this.height - 80; // ä»ªè¡¨ç›˜ä¸­å¿ƒYåæ ‡
                const radius = 40; // ä»ªè¡¨ç›˜åŠå¾„
                const sway = this.player.sway;
                
                // ç»˜åˆ¶ä»ªè¡¨ç›˜å¤–åœˆ
                this.ctx.strokeStyle = '#333';
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.arc(x, y, radius, 0, Math.PI * 2);
                this.ctx.stroke();
                
                // ç»˜åˆ¶ä»ªè¡¨ç›˜èƒŒæ™¯
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                this.ctx.beginPath();
                this.ctx.arc(x, y, radius - 2, 0, Math.PI * 2);
                this.ctx.fill();
                
                // ç»˜åˆ¶è§’åº¦åˆ»åº¦åŒºåŸŸï¼ˆæ‰‡å½¢ï¼‰
                const centerAngle = Math.PI / 2; // ä¸­å¿ƒè§’åº¦ï¼ˆå‚ç›´å‘ä¸Šï¼‰
                const maxAngle = Math.PI * 0.75; // æœ€å¤§è§’åº¦èŒƒå›´ï¼ˆ270åº¦ï¼‰
                
                // ç»¿è‰²åŒºåŸŸ (0-20åº¦)
                this.ctx.fillStyle = 'rgba(0, 255, 0, 0.3)';
                this.ctx.beginPath();
                this.ctx.moveTo(x, y);
                this.ctx.arc(x, y, radius - 5, centerAngle - maxAngle * 0.22, centerAngle + maxAngle * 0.22);
                this.ctx.closePath();
                    this.ctx.fill();
                    
                // é»„è‰²åŒºåŸŸ (20-40åº¦)
                this.ctx.fillStyle = 'rgba(255, 255, 0, 0.3)';
                    this.ctx.beginPath();
                this.ctx.moveTo(x, y);
                this.ctx.arc(x, y, radius - 5, centerAngle - maxAngle * 0.44, centerAngle - maxAngle * 0.22);
                this.ctx.arc(x, y, radius - 5, centerAngle + maxAngle * 0.22, centerAngle + maxAngle * 0.44);
                this.ctx.closePath();
                    this.ctx.fill();
            
                // çº¢è‰²åŒºåŸŸ (40-60åº¦)
                this.ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
                this.ctx.beginPath();
                this.ctx.moveTo(x, y);
                this.ctx.arc(x, y, radius - 5, centerAngle - maxAngle * 0.67, centerAngle - maxAngle * 0.44);
                this.ctx.arc(x, y, radius - 5, centerAngle + maxAngle * 0.44, centerAngle + maxAngle * 0.67);
                this.ctx.closePath();
                this.ctx.fill();
                
                // é»‘è‰²åŒºåŸŸ (60åº¦ä»¥ä¸Š)
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                this.ctx.beginPath();
                this.ctx.moveTo(x, y);
                this.ctx.arc(x, y, radius - 5, centerAngle - maxAngle, centerAngle - maxAngle * 0.67);
                this.ctx.arc(x, y, radius - 5, centerAngle + maxAngle * 0.67, centerAngle + maxAngle);
                this.ctx.closePath();
                this.ctx.fill();
                
                // ç»˜åˆ¶åˆ»åº¦çº¿
                this.ctx.strokeStyle = '#FFF';
                this.ctx.lineWidth = 1;
                for (let i = 0; i <= 60; i += 10) {
                    const angle = centerAngle - (i / 60) * maxAngle;
                    const x1 = x + Math.cos(angle) * (radius - 8);
                    const y1 = y + Math.sin(angle) * (radius - 8);
                    const x2 = x + Math.cos(angle) * (radius - 15);
                    const y2 = y + Math.sin(angle) * (radius - 15);
                    
                this.ctx.beginPath();
                    this.ctx.moveTo(x1, y1);
                    this.ctx.lineTo(x2, y2);
                this.ctx.stroke();
            }
            
                // ç»˜åˆ¶è§’åº¦æ•°å­—
                this.ctx.fillStyle = '#FFF';
                this.ctx.font = '10px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                for (let i = 0; i <= 60; i += 20) {
                    const angle = centerAngle - (i / 60) * maxAngle;
                    const textX = x + Math.cos(angle) * (radius - 25);
                    const textY = y + Math.sin(angle) * (radius - 25);
                    this.ctx.fillText(i.toString(), textX, textY);
                }
                
                // ç»˜åˆ¶æŒ‡é’ˆ
                const pointerAngle = centerAngle - (Math.abs(sway) / 60) * maxAngle;
                const pointerLength = radius - 10;
                
                // æ ¹æ®è§’åº¦é€‰æ‹©æŒ‡é’ˆé¢œè‰²
                let pointerColor = '#FFF';
                if (Math.abs(sway) <= 20) {
                    pointerColor = '#0F0'; // ç»¿è‰²
                } else if (Math.abs(sway) <= 40) {
                    pointerColor = '#FF0'; // é»„è‰²
                } else if (Math.abs(sway) <= 60) {
                    pointerColor = '#F00'; // çº¢è‰²
                } else {
                    pointerColor = '#000'; // é»‘è‰²
                }
                
                this.ctx.strokeStyle = pointerColor;
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.moveTo(x, y);
                this.ctx.lineTo(
                    x + Math.cos(pointerAngle) * pointerLength,
                    y + Math.sin(pointerAngle) * pointerLength
                );
                this.ctx.stroke();
                
                // ç»˜åˆ¶æŒ‡é’ˆä¸­å¿ƒç‚¹
                this.ctx.fillStyle = '#FFF';
                this.ctx.beginPath();
                this.ctx.arc(x, y, 3, 0, Math.PI * 2);
                this.ctx.fill();
                
                // æ˜¾ç¤ºå½“å‰è§’åº¦æ•°å€¼
                this.ctx.fillStyle = '#FFF';
                this.ctx.font = 'bold 12px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(Math.abs(sway).toFixed(1) + 'Â°', x, y + 50);
            }
            
            drawParticles() {
                this.particles.forEach(particle => {
                    this.ctx.save();
                    this.ctx.globalAlpha = particle.life;
                    this.ctx.fillStyle = '#FFD700';
                    this.ctx.beginPath();
                    this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    this.ctx.fill();
                    this.ctx.restore();
                });
            }
            
            drawPowerUps() {
                this.powerUps.forEach(powerUp => {
                    this.drawPowerUp(powerUp);
                });
            }
            
            drawPowerUp(powerUp) {
                // ä»£ç ç»˜åˆ¶çš„é“å…·ç³»ç»Ÿå·²ç§»é™¤
                return;
            }
            
            gameLoop() {
                this.update();
                this.render();
                requestAnimationFrame(() => this.gameLoop());
            }
        }
        
        // å¯åŠ¨æ¸¸æˆ
        window.addEventListener('load', () => {
            new TightropeGame();
        });
    </script>
</body>
</html>
