<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>钢丝行者 - 平衡挑战</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 加载界面 -->
    <div id="loadingScreen">
        <div class="wrapper">
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="shadow"></div>
            <div class="shadow"></div>
            <div class="shadow"></div>
        </div>
    </div>
    
    <div id="bgBlur"></div>
    <div id="gameContainer" data-design-width="832" data-design-height="1480">
        <canvas id="gameCanvas" width="832" height="1480"></canvas>
        
        <div id="progressContainer">
            <div id="progressBar">
                <div id="progressFill"></div>
                <div id="bestDistanceLine"></div>
                <div id="maxDistance">6666m</div>
            </div>
            <div id="bestDistanceLabel">0m</div>
            <div id="currentDistance">
                <span id="currentDistanceNumber">0</span><span id="currentDistanceUnit">m</span>
            </div>
        </div>
        
        <!-- 全局音频控制 -->
        <div id="audioControls">
            <button id="muteBtn" title="静音/取消静音">🔊</button>
            <input type="range" id="volumeSlider" min="0" max="100" value="30" title="音量控制">
        </div>
        
        <!-- 全局操作说明问号 -->
        <div id="helpTrigger">
            <div class="help-icon">?</div>
            <!-- 操作说明内容 -->
            <div id="instructions">
                <div class="instruction-item">
                    <span class="key">⇐ ⇒</span>
                    <span class="desc">控制平衡</span>
                </div>
                <div class="instruction-item">
                    <span class="key">Z</span>
                    <span class="desc">伸长平衡杆</span>
                </div>
                <div class="instruction-item">
                    <span class="key">X</span>
                    <span class="desc">缩短平衡杆</span>
                </div>
                <div class="instruction-item">
                    <span class="key">空格</span>
                    <span class="desc">开始/暂停</span>
                </div>
                <div class="instruction-tip">保持摆幅 < 60° 避免坠落</div>
            </div>
        </div>
        
        <div id="startScreen">
            <!-- 开始按钮 -->
            <button id="startButton">
                <span>按空格键开始游戏</span>
            </button>
        </div>
        <div id="gameOver">
            <h2 id="gameOverTitle">游戏结束！</h2>
            <p id="gameOverMessage">你走了 <span id="finalDistance">0</span> 米</p>
            <div class="restart-prompt">
                <p>按空格键重新挑战</p>
            </div>
        </div>
        
        <div id="pauseScreen">
            <h2>游戏暂停</h2>
            <div class="powerup-guide">
                <h3>道具说明</h3>
                <div class="powerup-list">
                    <div class="powerup-item">
                        <div class="powerup-icon slow-icon">
                            <img src="image/item_slow.png" alt="减速道具">
                        </div>
                        <div class="powerup-info">
                            <span class="powerup-name">减速道具</span>
                            <span class="powerup-desc">降低移动速度</span>
                        </div>
                    </div>
                    <div class="powerup-item">
                        <div class="powerup-icon unbalance-icon">
                            <img src="image/item_disrupt the balance.png" alt="失衡道具">
                        </div>
                        <div class="powerup-info">
                            <span class="powerup-name">失衡道具</span>
                            <span class="powerup-desc">增加摆幅难度</span>
                        </div>
                    </div>
                    <div class="powerup-item">
                        <div class="powerup-icon explosion-icon">
                            <img src="image/item_bomb.png" alt="爆炸道具">
                        </div>
                        <div class="powerup-info">
                            <span class="powerup-name">爆炸道具</span>
                            <span class="powerup-desc">直接游戏结束</span>
                        </div>
                    </div>
                    <div class="powerup-item">
                        <div class="powerup-icon speed-icon">
                            <img src="image/item_fast.png" alt="加速道具">
                        </div>
                        <div class="powerup-info">
                            <span class="powerup-name">加速道具</span>
                            <span class="powerup-desc">提升移动速度2倍</span>
                        </div>
                    </div>
                    <div class="powerup-item">
                        <div class="powerup-icon balance-icon">
                            <img src="image/item_keep balance.png" alt="平衡道具">
                        </div>
                        <div class="powerup-info">
                            <span class="powerup-name">平衡道具</span>
                            <span class="powerup-desc">保持平衡3秒</span>
                        </div>
                    </div>
                </div>
            </div>
            <p class="continue-text">按空格键继续游戏</p>
        </div>
    </div>

    <script src="main.js"></script>
    <script>
        class TightropeGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.width = this.canvas.width;
                this.height = this.canvas.height;
                
                // 游戏状态
                this.gameRunning = false;
                this.distance = 0;
                this.speed = 0.083; // 1秒5米，60fps下每帧约0.083米
                this.score = 0;
                this.highScore = localStorage.getItem('tightropeHighScore') || 0;
                this.gameStarted = false;
                
                // 主角属性
                this.player = {
                    x: this.width / 2,
                    y: this.height / 2,
                    sway: 0, // 摆幅角度
                    swaySpeed: 0, // 摆幅速度
                    size: 40
                };
                
                // 钢丝
                this.tightrope = {
                    x: this.width / 2,
                    thickness: 6
                };
                
                // 风力系统
                this.wind = {
                    force: 0,
                    direction: 1, // 1 或 -1
                    changeTimer: 0,
                    changeInterval: 60 // 帧数
                };
                
                // 背景
                this.background = {
                    offset: 0,
                    speed: 1
                };
                
                // 粒子系统
                this.particles = [];
                
                // 田园风景系统已移除
                this.landscape = [];
                this.landscapeSpeed = this.speed * 2;
                this.landscapeSpawnTimer = 0;
                this.landscapeSpawnInterval = 200;
                
                
                // 道具系统
                this.powerUps = [];
                this.powerUpSpawnTimer = 0;
                this.powerUpSpawnInterval = 20; // 帧数，0.3秒生成一个
                this.activePowerUps = []; // 当前激活的道具
                
                // 平衡杆系统
                this.balanceRod = {
                    length: 60, // 默认长度
                    minLength: 30,
                    maxLength: 120,
                    extendSpeed: 2
                };
                
                // 控制
                this.keys = {};
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.gameLoop();
            }
            
            setupEventListeners() {
                // 键盘事件
                document.addEventListener('keydown', (e) => {
                    this.keys[e.code] = true;
                    if (e.code === 'Space' && !this.gameRunning) {
                        this.startGame();
                    }
                });
                
                document.addEventListener('keyup', (e) => {
                    this.keys[e.code] = false;
                });
                
                // 重新开始按钮
                document.getElementById('restartBtn').addEventListener('click', () => {
                    this.restartGame();
                });
            }
            
            startGame() {
                this.gameRunning = true;
                this.gameStarted = true;
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('gameOver').style.display = 'none';
                this.resetGame();
                // 田园风景系统已移除
            }
            
            restartGame() {
                this.gameRunning = true;
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('gameOver').style.display = 'none';
                this.resetGame();
                // 田园风景系统已移除
            }
            
            resetGame() {
                this.distance = 0;
                this.score = 0;
                this.player.x = this.width / 2;
                this.player.y = this.height / 2;
                this.player.sway = 0;
                this.player.swaySpeed = 0;
                this.wind.force = 0;
                this.wind.direction = 1;
                this.wind.changeTimer = 0;
                this.background.offset = 0;
                this.landscape = [];
                this.landscapeSpawnTimer = 0;
                this.powerUps = [];
                this.powerUpSpawnTimer = 0;
                this.activePowerUps = [];
                this.balanceRod.length = 60;
            }
            
            update() {
                if (!this.gameRunning) return;
                
                // 更新距离和分数
                this.distance += this.speed;
                this.score = Math.floor(this.distance);
                
                // 更新风力
                this.updateWind();
                
                // 更新玩家平衡
                this.updatePlayerBalance();
                
                // 更新背景
                this.updateBackground();
                
                // 更新粒子
                this.updateParticles();
                
                // 田园风景系统已移除
                
                
                // 更新道具
                this.updatePowerUps();
                
                // 更新平衡杆
                this.updateBalanceRod();
                
                // 检查失败条件
                this.checkGameOver();
                
                // 更新UI
                this.updateUI();
            }
            
            updateWind() {
                this.wind.changeTimer++;
                if (this.wind.changeTimer >= this.wind.changeInterval) {
                    this.wind.direction *= -1;
                    this.wind.force = (Math.random() - 0.5) * 0.3;
                    this.wind.changeTimer = 0;
                    this.wind.changeInterval = 30 + Math.random() * 60;
                }
                
                // 风力逐渐变化
                this.wind.force += (Math.random() - 0.5) * 0.02;
                this.wind.force = Math.max(-0.5, Math.min(0.5, this.wind.force));
            }
            
            updatePlayerBalance() {
                // 检查是否有平衡增强道具且免疫键盘输入
                let isImmuneToInput = false;
                let isBalanceRestore = false;
                for (let powerUp of this.activePowerUps) {
                    if (powerUp.type === 'balance' && powerUp.immuneToInput) {
                        isImmuneToInput = true;
                        if (powerUp.balanceRestore) {
                            isBalanceRestore = true;
                        }
                        break;
                    }
                }
                
                // 如果处于平衡恢复状态，保持平衡
                if (isBalanceRestore) {
                    this.player.sway = 0; // 强制保持平衡
                    this.player.swaySpeed = 0; // 停止摆荡
                    return; // 直接返回，不处理其他力
                }
                
                // 风力影响（缩小两倍）
                let windEffect = this.wind.force * this.wind.direction * 0.5; // 从1缩小到0.5
                
                // 玩家控制（缩小两倍，且可能被免疫）
                let controlForce = 0;
                if (!isImmuneToInput) { // 只有在不免疫键盘输入时才响应
                    if (this.keys['ArrowLeft']) {
                        controlForce = -0.075; // 从-0.15缩小到-0.075
                    }
                    if (this.keys['ArrowRight']) {
                        controlForce = 0.075; // 从0.15缩小到0.075
                    }
                }
                
                // 计算总力
                let totalForce = windEffect + controlForce;
                
                // 更新摆幅速度
                this.player.swaySpeed += totalForce;
                
                // 应用平衡道具效果
                let damping = 0.95; // 默认阻尼
                for (let powerUp of this.activePowerUps) {
                    if (powerUp.type === 'balance') {
                        damping = 0.98; // 增强阻尼，减少摆荡
                    } else if (powerUp.type === 'unbalance') {
                        damping = 0.90; // 减少阻尼，增加摆荡
                    }
                }
                this.player.swaySpeed *= damping;
                
                // 更新摆幅
                this.player.sway += this.player.swaySpeed;
                
                // 限制摆幅范围
                this.player.sway = Math.max(-90, Math.min(90, this.player.sway));
                
                // 更新玩家位置（以脚为圆心旋转）
                this.player.x = this.tightrope.x;
                this.player.y = this.height / 2;
            }
            
            updateBackground() {
                this.background.offset += this.background.speed;
                if (this.background.offset >= this.height) {
                    this.background.offset = 0;
                }
            }
            
            updateParticles() {
                // 添加新粒子
                if (Math.random() < 0.3) {
                    this.particles.push({
                        x: Math.random() * this.width,
                        y: this.height + 10,
                        vx: (Math.random() - 0.5) * 2,
                        vy: -Math.random() * 3 - 1,
                        life: 1.0,
                        decay: 0.01,
                        size: Math.random() * 3 + 1
                    });
                }
                
                // 更新现有粒子
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const particle = this.particles[i];
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life -= particle.decay;
                    
                    if (particle.life <= 0 || particle.y < -10) {
                        this.particles.splice(i, 1);
                    }
                }
            }
            
            updateLandscape() {
                // 田园风景系统已移除
                return;
            }
            
            
            updatePowerUps() {
                // 生成新道具
                this.powerUpSpawnTimer++;
                if (this.powerUpSpawnTimer >= this.powerUpSpawnInterval) {
                    this.spawnPowerUp();
                    this.powerUpSpawnTimer = 0;
                    this.powerUpSpawnInterval = 60 + Math.random() * 60; // 1-2秒随机间隔
                }
                
                // 更新现有道具位置
                for (let i = this.powerUps.length - 1; i >= 0; i--) {
                    const powerUp = this.powerUps[i];
                    powerUp.y += 7; // 下落速度减缓到1/3
                    
                    // 检查是否被玩家收集
                    if (this.checkPowerUpCollision(powerUp)) {
                        this.collectPowerUp(powerUp);
                        this.powerUps.splice(i, 1);
                    }
                    // 移除超出屏幕的道具
                    else if (powerUp.y > this.height + 100) {
                        this.powerUps.splice(i, 1);
                    }
                }
                
                // 更新激活的道具
                for (let i = this.activePowerUps.length - 1; i >= 0; i--) {
                    const powerUp = this.activePowerUps[i];
                    powerUp.duration--;
                    
                    if (powerUp.duration <= 0) {
                        this.deactivatePowerUp(powerUp);
                        this.activePowerUps.splice(i, 1);
                    }
                }
            }
            
            updateBalanceRod() {
                // 平衡杆伸长缩短控制
                if (this.keys['KeyZ'] || this.keys['KeyX']) {
                    if (this.keys['KeyZ']) {
                        // Z键伸长
                        this.balanceRod.length = Math.min(this.balanceRod.maxLength, 
                            this.balanceRod.length + this.balanceRod.extendSpeed);
                    }
                    if (this.keys['KeyX']) {
                        // X键缩短
                        this.balanceRod.length = Math.max(this.balanceRod.minLength, 
                            this.balanceRod.length - this.balanceRod.extendSpeed);
                    }
                }
            }
            
            spawnLandscapeElement() {
                // 不再生成代码绘制的元素
                return;
            }
            
            
            spawnPowerUp() {
                // 减少爆炸出现频率，其他道具出现概率更高
                const types = ['speed', 'balance', 'slow', 'unbalance', 'speed', 'balance', 'slow', 'unbalance', 'explosion']; // 爆炸只有1/9的概率
                const type = types[Math.floor(Math.random() * types.length)];
                
                // 道具掉落范围：从平衡杆初始长度到平衡杆最长伸长长度
                const tightropeX = this.tightrope.x;
                const minDistance = this.balanceRod.minLength+10; // 平衡杆初始长度
                const maxDistance = this.balanceRod.maxLength; // 平衡杆最长伸长长度
                
                // 随机选择左侧或右侧
                const side = Math.random() < 0.5 ? -1 : 1;
                const distance = minDistance + Math.random() * (maxDistance - minDistance);
                const x = tightropeX + (side * distance);
                
                this.powerUps.push({
                    x: x,
                    y: -50, // 从屏幕上方开始
                    type: type,
                    size: 20,
                    collected: false
                });
            }
            
            checkPowerUpCollision(powerUp) {
                // 检查道具是否与平衡杆碰撞
                const playerX = this.tightrope.x;
                const playerY = this.height / 2;
                const rodLength = this.balanceRod.length;
                
                // 平衡杆的左右端点
                const rodLeft = playerX - rodLength;
                const rodRight = playerX + rodLength;
                
                // 检查道具是否在平衡杆范围内
                return powerUp.x >= rodLeft && powerUp.x <= rodRight && 
                       powerUp.y >= playerY - 20 && powerUp.y <= playerY + 20;
            }
            
            collectPowerUp(powerUp) {
                // 播放音效
                this.playSound(powerUp.type);
                
                // 显示道具效果
                this.showPowerUpEffect(powerUp);
                
                // 检查平衡道具是否会被其他道具影响
                if (this.hasActivePowerUp('balance') && (powerUp.type === 'unbalance' || powerUp.type === 'slow')) {
                    // 平衡道具遇到失衡或减速道具时立即失效
                    this.clearBalanceEffect();
                }
                
                // 激活新道具效果
                const activePowerUp = {
                    type: powerUp.type,
                    duration: powerUp.type === 'balance' ? 180 : 300, // 平衡3秒，其他5秒，60fps
                    originalValue: null
                };
                
                if (powerUp.type === 'explosion') {
                    // 爆炸道具 - 直接死亡
                    this.gameOver();
                    return;
                } else if (powerUp.type === 'speed') {
                    // 加速道具 - 可以叠加
                    if (this.hasActivePowerUp('speed')) {
                        // 如果已有加速效果，叠加效果
                        this.speed *= 2; // 再次提升2倍
                    } else {
                        // 首次获得加速效果
                        activePowerUp.originalValue = this.speed;
                        this.speed *= 2; // 速度提升2倍
                    }
                } else if (powerUp.type === 'balance') {
                    // 平衡增强道具 - 可以叠加
                    this.player.sway = 0; // 立即回到中心位置
                    this.player.swaySpeed = 0; // 停止摆荡
                    if (!this.hasActivePowerUp('balance')) {
                        // 首次获得平衡效果
                        activePowerUp.originalValue = 0.95; // 阻尼系数
                        activePowerUp.immuneToInput = true; // 标记为免疫键盘输入
                        activePowerUp.balanceRestore = true; // 标记为平衡恢复状态
                    } else {
                        // 叠加平衡效果，延长持续时间
                        const existingBalance = this.activePowerUps.find(p => p.type === 'balance');
                        existingBalance.duration = 180; // 重置持续时间为3秒
                    }
                } else if (powerUp.type === 'slow') {
                    // 减速道具 - 可以叠加
                    if (this.hasActivePowerUp('slow')) {
                        // 如果已有减速效果，叠加效果
                        this.speed *= 0.5; // 再次除以2
                    } else {
                        // 首次获得减速效果
                        activePowerUp.originalValue = this.speed;
                        this.speed *= 0.5; // 速度除以2
                    }
                } else if (powerUp.type === 'unbalance') {
                    // 破坏平衡道具 - 失衡效果，向道具下落方向旋转15度
                    const unbalanceOffset = powerUp.x > this.tightrope.x ? 15 : -15; // 根据道具位置决定旋转方向
                    this.player.sway += unbalanceOffset; // 向道具下落方向旋转15度
                    // 失衡道具也可以叠加，延长持续时间
                    if (this.hasActivePowerUp('unbalance')) {
                        const existingUnbalance = this.activePowerUps.find(p => p.type === 'unbalance');
                        existingUnbalance.duration = 300; // 重置持续时间为5秒
                        return; // 不创建新的activePowerUp
                    }
                }
                
                // 只有首次获得的道具才添加到activePowerUps
                if (!this.hasActivePowerUp(powerUp.type)) {
                    this.activePowerUps.push(activePowerUp);
                }
            }
            
            hasActivePowerUp(type) {
                // 检查是否有指定类型的激活道具
                return this.activePowerUps.some(powerUp => powerUp.type === type);
            }
            
            clearBalanceEffect() {
                // 清除平衡道具效果
                const balanceIndex = this.activePowerUps.findIndex(powerUp => powerUp.type === 'balance');
                if (balanceIndex !== -1) {
                    this.activePowerUps.splice(balanceIndex, 1);
                }
                // 恢复原始阻尼系数
                this.player.damping = 0.95;
            }
            
            clearAllPowerUpEffects() {
                // 清除所有现有道具效果，恢复原始状态
                for (let powerUp of this.activePowerUps) {
                    if (powerUp.type === 'speed' || powerUp.type === 'slow') {
                        this.speed = powerUp.originalValue;
                    }
                    // 其他效果会自动恢复
                }
                this.activePowerUps = []; // 清空所有激活的道具
            }
            
            deactivatePowerUp(powerUp) {
                // 取消道具效果
                if (powerUp.type === 'speed') {
                    // 对于叠加的加速效果，需要逐步恢复
                    this.speed = powerUp.originalValue;
                } else if (powerUp.type === 'balance') {
                    // 恢复原始阻尼
                } else if (powerUp.type === 'slow') {
                    // 对于叠加的减速效果，需要逐步恢复
                    this.speed = powerUp.originalValue;
                } else if (powerUp.type === 'unbalance') {
                    // 恢复原始阻尼
                }
            }
            
            playSound(type) {
                // 简单的音效模拟（使用Web Audio API）
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    // 根据道具类型设置不同音效
                    if (type === 'speed' || type === 'balance') {
                        // 正面道具 - 高音
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    } else if (type === 'explosion') {
                        // 死亡道具 - 低音
                        oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    } else {
                        // 负面道具 - 中音
                        oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    }
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (e) {
                    // 音效播放失败时静默处理
                }
            }
            
            showPowerUpEffect(powerUp) {
                // 显示道具效果文字 - 加大两倍并显示在屏幕正中间人物下方
                const effectText = document.createElement('div');
                effectText.style.position = 'absolute';
                effectText.style.left = '50%';
                effectText.style.top = '60%'; // 人物下方
                effectText.style.transform = 'translateX(-50%)'; // 水平居中
                effectText.style.color = this.getPowerUpColor(powerUp.type);
                effectText.style.fontSize = '40px'; // 加大两倍（从20px到40px）
                effectText.style.fontWeight = 'bold';
                effectText.style.pointerEvents = 'none';
                effectText.style.zIndex = '1000';
                effectText.style.textAlign = 'center';
                effectText.style.textShadow = '2px 2px 4px rgba(0,0,0,0.8)'; // 添加阴影增强可读性
                effectText.textContent = this.getPowerUpText(powerUp.type);
                
                document.body.appendChild(effectText);
                
                // 动画效果
                let opacity = 1;
                let y = 60; // 从60%开始
                const animate = () => {
                    opacity -= 0.015; // 稍微慢一点的淡出
                    y -= 0.5; // 向上移动
                    effectText.style.opacity = opacity;
                    effectText.style.top = y + '%';
                    
                    if (opacity > 0) {
                        requestAnimationFrame(animate);
                    } else {
                        document.body.removeChild(effectText);
                    }
                };
                animate();
            }
            
            getPowerUpColor(type) {
                const colors = {
                    'speed': '#FF0000',      // 红色 - 好道具
                    'balance': '#FF0000',    // 红色 - 好道具
                    'explosion': '#000000',  // 黑色 - 坏道具
                    'rock': '#000000',       // 黑色 - 坏道具
                    'slow': '#000000',       // 黑色 - 坏道具
                    'unbalance': '#000000'   // 黑色 - 坏道具
                };
                return colors[type] || '#FFFFFF';
            }
            
            getPowerUpText(type) {
                const texts = {
                    'explosion': '爆炸!',
                    'speed': '速度提升!',
                    'balance': '平衡增强!',
                    'slow': '减速!',
                    'unbalance': '平衡破坏!'
                };
                return texts[type] || '未知道具';
            }
            
            initializeLandscape() {
                // 田园风景系统已移除
                return;
            }
            
            
            checkGameOver() {
                if (Math.abs(this.player.sway) >= 60) {
                    this.gameOver();
                }
            }
            
            gameOver() {
                this.gameRunning = false;
                const finalScore = Math.floor(this.distance);
                document.getElementById('finalDistance').textContent = finalScore;
                
                // 更新最高分
                if (finalScore > this.highScore) {
                    this.highScore = finalScore;
                    localStorage.setItem('tightropeHighScore', this.highScore);
                }
                
                document.getElementById('gameOver').style.display = 'block';
            }
            
            updateUI() {
                document.getElementById('distance').textContent = Math.floor(this.distance);
                document.getElementById('sway').textContent = Math.floor(Math.abs(this.player.sway));
                document.getElementById('wind').textContent = (this.wind.force * this.wind.direction).toFixed(2);
                document.getElementById('highScore').textContent = this.highScore;
            }
            
            render() {
                // 清空画布
                this.ctx.clearRect(0, 0, this.width, this.height);
                
                // 绘制背景
                this.drawBackground();
                
                // 代码绘制的钢丝已移除
                // 代码绘制的玩家角色已移除
                // 代码绘制的风力指示器已移除
                
                // 绘制摆幅指示器
                this.drawSwayIndicator();
                
                // 绘制粒子
                this.drawParticles();
                
                // 绘制道具
                this.drawPowerUps();
            }
            
            drawBackground() {
                // 渐变背景已移除，不再绘制任何代码生成的背景
                // 田园风景系统已移除
                // 装饰气球已删除
            }
            
            
            
            drawScrollingLandscape() {
                // 田园风景系统已移除
                return;
            }
            
            drawLandscapeElement(element) {
                // 不再绘制代码生成的元素
                return;
            }
            
            
            drawBalloons() {
                // 装饰气球已删除
                return;
            }
            
            drawTightrope() {
                // 代码绘制的钢丝已移除
                return;
            }
            
            drawPlayer() {
                // 代码绘制的玩家角色已移除
                return;
            }
            
            drawWindIndicator() {
                // 代码绘制的风力指示器已移除
                return;
            }
            
            drawSwayIndicator() {
                const x = 80; // 仪表盘中心X坐标
                const y = this.height - 80; // 仪表盘中心Y坐标
                const radius = 40; // 仪表盘半径
                const sway = this.player.sway;
                
                // 绘制仪表盘外圈
                this.ctx.strokeStyle = '#333';
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.arc(x, y, radius, 0, Math.PI * 2);
                this.ctx.stroke();
                
                // 绘制仪表盘背景
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                this.ctx.beginPath();
                this.ctx.arc(x, y, radius - 2, 0, Math.PI * 2);
                this.ctx.fill();
                
                // 绘制角度刻度区域（扇形）
                const centerAngle = Math.PI / 2; // 中心角度（垂直向上）
                const maxAngle = Math.PI * 0.75; // 最大角度范围（270度）
                
                // 绿色区域 (0-20度)
                this.ctx.fillStyle = 'rgba(0, 255, 0, 0.3)';
                this.ctx.beginPath();
                this.ctx.moveTo(x, y);
                this.ctx.arc(x, y, radius - 5, centerAngle - maxAngle * 0.22, centerAngle + maxAngle * 0.22);
                this.ctx.closePath();
                    this.ctx.fill();
                    
                // 黄色区域 (20-40度)
                this.ctx.fillStyle = 'rgba(255, 255, 0, 0.3)';
                    this.ctx.beginPath();
                this.ctx.moveTo(x, y);
                this.ctx.arc(x, y, radius - 5, centerAngle - maxAngle * 0.44, centerAngle - maxAngle * 0.22);
                this.ctx.arc(x, y, radius - 5, centerAngle + maxAngle * 0.22, centerAngle + maxAngle * 0.44);
                this.ctx.closePath();
                    this.ctx.fill();
            
                // 红色区域 (40-60度)
                this.ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
                this.ctx.beginPath();
                this.ctx.moveTo(x, y);
                this.ctx.arc(x, y, radius - 5, centerAngle - maxAngle * 0.67, centerAngle - maxAngle * 0.44);
                this.ctx.arc(x, y, radius - 5, centerAngle + maxAngle * 0.44, centerAngle + maxAngle * 0.67);
                this.ctx.closePath();
                this.ctx.fill();
                
                // 黑色区域 (60度以上)
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                this.ctx.beginPath();
                this.ctx.moveTo(x, y);
                this.ctx.arc(x, y, radius - 5, centerAngle - maxAngle, centerAngle - maxAngle * 0.67);
                this.ctx.arc(x, y, radius - 5, centerAngle + maxAngle * 0.67, centerAngle + maxAngle);
                this.ctx.closePath();
                this.ctx.fill();
                
                // 绘制刻度线
                this.ctx.strokeStyle = '#FFF';
                this.ctx.lineWidth = 1;
                for (let i = 0; i <= 60; i += 10) {
                    const angle = centerAngle - (i / 60) * maxAngle;
                    const x1 = x + Math.cos(angle) * (radius - 8);
                    const y1 = y + Math.sin(angle) * (radius - 8);
                    const x2 = x + Math.cos(angle) * (radius - 15);
                    const y2 = y + Math.sin(angle) * (radius - 15);
                    
                this.ctx.beginPath();
                    this.ctx.moveTo(x1, y1);
                    this.ctx.lineTo(x2, y2);
                this.ctx.stroke();
            }
            
                // 绘制角度数字
                this.ctx.fillStyle = '#FFF';
                this.ctx.font = '10px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                for (let i = 0; i <= 60; i += 20) {
                    const angle = centerAngle - (i / 60) * maxAngle;
                    const textX = x + Math.cos(angle) * (radius - 25);
                    const textY = y + Math.sin(angle) * (radius - 25);
                    this.ctx.fillText(i.toString(), textX, textY);
                }
                
                // 绘制指针
                const pointerAngle = centerAngle - (Math.abs(sway) / 60) * maxAngle;
                const pointerLength = radius - 10;
                
                // 根据角度选择指针颜色
                let pointerColor = '#FFF';
                if (Math.abs(sway) <= 20) {
                    pointerColor = '#0F0'; // 绿色
                } else if (Math.abs(sway) <= 40) {
                    pointerColor = '#FF0'; // 黄色
                } else if (Math.abs(sway) <= 60) {
                    pointerColor = '#F00'; // 红色
                } else {
                    pointerColor = '#000'; // 黑色
                }
                
                this.ctx.strokeStyle = pointerColor;
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.moveTo(x, y);
                this.ctx.lineTo(
                    x + Math.cos(pointerAngle) * pointerLength,
                    y + Math.sin(pointerAngle) * pointerLength
                );
                this.ctx.stroke();
                
                // 绘制指针中心点
                this.ctx.fillStyle = '#FFF';
                this.ctx.beginPath();
                this.ctx.arc(x, y, 3, 0, Math.PI * 2);
                this.ctx.fill();
                
                // 显示当前角度数值
                this.ctx.fillStyle = '#FFF';
                this.ctx.font = 'bold 12px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(Math.abs(sway).toFixed(1) + '°', x, y + 50);
            }
            
            drawParticles() {
                this.particles.forEach(particle => {
                    this.ctx.save();
                    this.ctx.globalAlpha = particle.life;
                    this.ctx.fillStyle = '#FFD700';
                    this.ctx.beginPath();
                    this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    this.ctx.fill();
                    this.ctx.restore();
                });
            }
            
            drawPowerUps() {
                this.powerUps.forEach(powerUp => {
                    this.drawPowerUp(powerUp);
                });
            }
            
            drawPowerUp(powerUp) {
                // 代码绘制的道具系统已移除
                return;
            }
            
            gameLoop() {
                this.update();
                this.render();
                requestAnimationFrame(() => this.gameLoop());
            }
        }
        
        // 启动游戏
        window.addEventListener('load', () => {
            new TightropeGame();
        });
    </script>
</body>
</html>
